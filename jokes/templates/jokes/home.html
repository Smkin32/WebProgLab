{% extends 'jokes/base.html' %}

{% block content %}
<div class="search-form">
    {% if user.is_authenticated %}
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</h2>
        <p>–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞ –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤!</p>
    {% else %}
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç –∞–Ω–µ–∫–¥–æ—Ç–æ–≤!</h2>
        <p>–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ –ª—É—á—à–∏–µ —à—É—Ç–∫–∏ –∏ –∞–Ω–µ–∫–¥–æ—Ç—ã –Ω–∞ –ª—é–±–æ–π –≤–∫—É—Å. <a href="{% url 'jokes:login' %}">–í–æ–π–¥–∏—Ç–µ</a> –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.</p>
    {% endif %}
</div>

{% if messages %}
    {% for message in messages %}
        <div style="padding: 1rem; margin-bottom: 1rem; border-radius: 5px; 
                    background-color: {% if message.tags == 'error' %}#f8d7da; color: #721c24; border: 1px solid #f5c6cb;{% else %}#d4edda; color: #155724; border: 1px solid #c3e6cb;{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

{% if joke_of_day %}
<div class="joke-card" style="border: 2px solid #667eea;">
    <h2 style="color: #667eea; margin-bottom: 1rem;">üé≠ –ê–Ω–µ–∫–¥–æ—Ç –¥–Ω—è</h2>
    <div class="joke-content">{{ joke_of_day.content|linebreaks }}</div>
    <div class="joke-actions">
        {% csrf_token %}
        <div class="rating">
            <button onclick="rateJoke({{ joke_of_day.id }}, 'up')" class="up">üëç</button>
            <span id="rating-{{ joke_of_day.id }}">{{ joke_of_day.rating }}</span>
            <button onclick="rateJoke({{ joke_of_day.id }}, 'down')" class="down">üëé</button>
        </div>
        <a href="{% url 'jokes:detail' joke_of_day.id %}" class="btn btn-primary">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</a>
    </div>
</div>
{% endif %}

<h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–Ω–µ–∫–¥–æ—Ç—ã</h2>

{% if latest_jokes %}
    {% for joke in latest_jokes %}
    <div class="joke-card">
        <div class="joke-meta">
            <span class="category-tag">{{ joke.get_category_display }}</span>
            <span>{{ joke.created_at|date:"d.m.Y H:i" }} | –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ joke.views }}</span>
        </div>

        {% if joke.title %}
            <h3>{{ joke.title }}</h3>
        {% endif %}

        <div class="joke-content">{{ joke.get_short_content|linebreaks }}</div>

        <div class="joke-actions">
            {% csrf_token %}
            <div class="rating">
                <button onclick="rateJoke({{ joke.id }}, 'up')" class="up">üëç</button>
                <span id="rating-{{ joke.id }}">{{ joke.rating }}</span>
                <button onclick="rateJoke({{ joke.id }}, 'down')" class="down">üëé</button>
            </div>
            <a href="{% url 'jokes:detail' joke.id %}" class="btn btn-primary">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</a>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="joke-card">
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∞–Ω–µ–∫–¥–æ—Ç–æ–≤. <a href="/admin/">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</a></p>
    </div>
{% endif %}

<div style="text-align: center; margin-top: 2rem;">
    <a href="{% url 'jokes:list' %}" class="btn btn-primary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∞–Ω–µ–∫–¥–æ—Ç—ã</a>
</div>
{% endblock %}