
{% extends 'jokes/base.html' %}

{% block title %}–í—Å–µ –∞–Ω–µ–∫–¥–æ—Ç—ã{% endblock %}

{% block content %}
<h1>–í—Å–µ –∞–Ω–µ–∫–¥–æ—Ç—ã</h1>

<form method="get" class="search-form">
    <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤..." value="{{ search }}">
    <select name="category">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        {% for cat_value, cat_name in categories %}
            <option value="{{ cat_value }}" {% if category == cat_value %}selected{% endif %}>{{ cat_name }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
    {% if search or category %}
        <a href="{% url 'jokes:list' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
    {% endif %}
</form>

{% if page_obj %}
    {% for joke in page_obj %}
    <div class="joke-card">
        <div class="joke-meta">
            <span class="category-tag">{{ joke.get_category_display }}</span>
            <span>{{ joke.created_at|date:"d.m.Y H:i" }} | –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ joke.views }}</span>
        </div>
        
        {% if joke.title %}
            <h3>{{ joke.title }}</h3>
        {% endif %}
        
        <div class="joke-content">{{ joke.get_short_content|linebreaks }}</div>
        
        <div class="joke-actions">
            {% csrf_token %}
            <div class="rating">
                <button onclick="rateJoke({{ joke.id }}, 'up')" class="up">üëç</button>
                <span id="rating-{{ joke.id }}">{{ joke.rating }}</span>
                <button onclick="rateJoke({{ joke.id }}, 'down')" class="down">üëé</button>
            </div>
            <a href="{% url 'jokes:detail' joke.id %}" class="btn btn-primary">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</a>
        </div>
    </div>
    {% endfor %}

    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}">&laquo; –ø–µ—Ä–≤–∞—è</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}">–ø—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}

        <span class="current">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}">—Å–ª–µ–¥—É—é—â–∞—è</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}">–ø–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="joke-card">
        <p>–ê–Ω–µ–∫–¥–æ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    </div>
{% endif %}
{% endblock %}
